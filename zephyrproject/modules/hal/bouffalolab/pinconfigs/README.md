# Bouffalo Lab pin configurations

This directory contains a set of files describing valid pin configurations for
multiple Bouffalo Lab devices. This configuration files maps a pin to a
peripheral signal which multiplex, at end, I/O lines pins.

In the following sections the expected file format is described.

## Configuration

All fields are common, independently of the pin controller, and all fields are
mandatory.

- `model`: Always defined as `bflb,bl`
- `family`: Family name like: `bl60x`, `bl70x` etc
- `map`: Define the macro that will be used to generate code for an specific
  controller. Currently `BFLB_PINMUX` is used for all cases.
- `series`: The SoC series set
- `pins`: The pin map itself

Example:

The below `yaml` snip have all the common fields defined. It defines few
aleatory pins to help understand the definition schema.

```yaml
# Pin codes:
#
# - BL602 32-pin
# - BL604 40-pin

model: bflb,bl

family: bl60x

map: BFLB_PINMUX

series: [602x, 604x]

pins:
  gpio0:
    series: [602x, 604x]
    analog:
      - [atest, [in]]
    periph:
      - [sdio, [clk]]
      - [flash, [d1]]
      - [spi, [mosi]]
      - [i2c, [scl]]
      - [uart0, [rts, cts, tx, rx]]
      - [uart1, [rts, cts, tx, rx]]
      - [pwm, [ch0]]
      - [fem, [gpio0]]
#     - [swgpio, [0]]
      - [jtag, [tms]]
```

The `series` key define a list of SoC models `[602x, 604x]`. This list is used
to generate file names and map peripherals. The series is used inside each pin
definition to identify which pins are available.

The `pins` section is a vaiable length list of pin definitions. Each entry is
a pin itself composed mandatory properties which are `series` and `periph`. The
`series` instructs the engine to generate pin definitions only for those models
were pin is, in fact, available. The `periph` is the set of multiplexed
peripheral signals. It is a variable length list where each entry is a list.
Each peripheral list entry is composed of 2 mandatory fields. The peripheral
list represents:
 - `peripheral function name [instance]`
 - `signal`

## Auto Generated Code

After define all pins the user should run `scripts/bflbpinctrl.py` script to
auto generate Zephyr RTOS devicetree pinctrl definitions. See `scripts/README`
for instructions how to do it.

### Output Format

The output format define constants to be used inside devicetree pins definitions,
see below snip of output:

```c
/*
 * Autogenerated file
 *
 * SPDX-License-Identifier: Apache-2.0
 */

#include <dt-bindings/pinctrl/bl60x_pinctrl.h>

/* gpio0_uart0_tx */
#define GPIO0_UART0_TX \
	BFLB_PINMUX(0, uart0, tx, periph)
```

The output format uses the compressed representation which of:
 - gpio index (GPIOx)
 - peripheral function with instance
 - alternate function (signal)
 - function (periph)

In this case `GPIO0_UART0_TX` uses the GPIO pin `0` to define the peripheral
function `UART` using the instance `0` with the alternate function `tx`.


## Devicetree definitions

The pinctrl devicetree entries follow current Zephyr RTOS conventions. See
below example which define serial console for `dt_bl10_devkit` board.

```devicetree
#include <dt-bindings/pinctrl/bl602x-pinctrl.h>

&pinctrl {
	uart0_default: uart0_default {
		group1 {
			pinmux = <GPIO0_UART0_TX>, <GPIO1_UART0_RX>;
		};
	};
};

&uart0 {
	status = "okay";
	compatible = "bflb,uart";
	current-speed = <115200>;
	#address-cells = <1>;
	#size-cells = <0>;

	pinctrl-0 = <&uart0_default>;
	pinctrl-names = "default";
};
```
